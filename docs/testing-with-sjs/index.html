<!doctype html>
<!--[if lt IE 7 ]><html itemscope itemtype="http://schema.org/Organization" id="ie6" class="ie ie-old" lang="en-US"><![endif]-->
<!--[if IE 7 ]>   <html itemscope itemtype="http://schema.org/Organization" id="ie7" class="ie ie-old" lang="en-US"><![endif]-->
<!--[if IE 8 ]>   <html itemscope itemtype="http://schema.org/Organization" id="ie8" class="ie ie-old" lang="en-US"><![endif]-->
<!--[if IE 9 ]>   <html itemscope itemtype="http://schema.org/Organization" id="ie9" class="ie" lang="en-US"><![endif]-->
<!--[if gt IE 9]><!--><html itemscope itemtype="http://schema.org/Organization" lang="en-US"><!--<![endif]-->
<head>

    <!-- Meta -->
    <meta charset="utf-8">
    <title>Testing With Server-side JavaScript - MarkLogic Unit Test</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Favicons -->
    <link rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64 96x96" href="/marklogic-unit-test/favicon.ico">
    <meta name="application-name" content="MarkLogic Unit Test - A Unit Test framework for MarkLogic">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-6638631-15', 'auto');
      ga('send', 'pageview');

    </script>

    <!-- Facebook Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
    n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
    document,'script','https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1879746318909687'); // Insert your pixel ID here.
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1879746318909687&ev=PageView&noscript=1"
    /></noscript>
    <!-- DO NOT MODIFY -->
    <!-- End Facebook Pixel Code -->
    <link type="text/css" rel="stylesheet" href="/marklogic-unit-test/assets/bundle.css">
</head>
<body class="">

    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/marklogic-unit-test">
                  <span class="logo">
                    <img src="/marklogic-unit-test/images/logo-marklogic.svg" width="180px" height="38px" alt="MarkLogic" title="MarkLogic" scale="0">
                  </span>
                  MarkLogic Unit Test
                </a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav navbar-right">
                    
                        <li  >
                            
                            <a href="/marklogic-unit-test/">Getting Started</a>
                            
                        </li>
                    
                        <li  >
                            
                            <a href="https://github.com/marklogic-community/marklogic-unit-test">GitHub</a>
                            
                        </li>
                    
                </ul>
            </div>
        </div>
    </nav>




  <article>
    <div class="container">
      <div class="row">
        <div class="side-nav col-md-3 hide-small">
          <div class="panel panel-default">
  <div class="panel-heading">Navigation</div>
  <ul class="list-group">
  
  <li  class="list-group-item"  >
    
    <a href="/marklogic-unit-test/">Getting Started</a>
    
    
  </li>
  
  <li  class="list-group-item"  >
    
    <a href="/marklogic-unit-test/include/">How to Include MarkLogic Unit Test in Your Project</a>
    
    
  </li>
  
  <li  class="list-group-item"  >
    
    <a href="/marklogic-unit-test/running/">How to Run Your Tests</a>
    
    
  </li>
  
  <li  class="list-group-item"  >
    
    <a href="/marklogic-unit-test/docs/">Docs</a>
    
    
      <ul class="list-group">
  
  <li  class="list-group-item"  >
    
    <a href="/marklogic-unit-test/docs/conventions/">Filename Conventions</a>
    
    
  </li>
  
  <li  class="list-group-item"  >
    
    <a href="/marklogic-unit-test/docs/loading-data/">Loading Data</a>
    
    
  </li>
  
  <li  class="list-group-item active"  >
    
    <a href="/marklogic-unit-test/docs/testing-with-sjs/">Testing With JavaScript</a>
    
    
  </li>
  
  <li  class="list-group-item"  >
    
    <a href="/marklogic-unit-test/docs/testing-with-xquery/">Testing With XQuery</a>
    
    
  </li>
  
  <li  class="list-group-item"  >
    
    <a href="/marklogic-unit-test/docs/assertions/">Assert Functions</a>
    
    
  </li>
  
  <li  class="list-group-item"  >
    
    <a href="/marklogic-unit-test/docs/transactional/">Transactional Unit Tests</a>
    
    
  </li>
  
</ul>

    
  </li>
  
  <li  class="list-group-item"  >
    
    <a href="https://github.com/marklogic-community/marklogic-unit-test">MarkLogic Unit Test on GitHub</a>
    
    
  </li>
  
</ul>

</div>

        </div>
        <div class="col-md-9">
          <h1 id="testing-with-server-side-javascript">Testing with Server-side JavaScript</h1>

<p>You can use MarkLogic Unit Test to test library modules written in SJS or in XQuery.</p>

<p>Your tests need to return the results of calling assertion functions. To do this with JavaScript tests, build an array
of assertion results and return the array. Note that this needs to be a flat array – that is, an array of assertion
results, not an array of arrays of assertion results.</p>

<p>The assertion functions compare expected results with the actual results. If the result of calling the function that 
you’re testing is complex enough to warrant multiple assertions, a convention is to hold the results in a variable 
called <code class="highlighter-rouge">actual</code>. This makes it clear to those reading your tests exactly what is being tested.</p>

<h2 id="testing-javascript-with-javascript">Testing JavaScript with JavaScript</h2>

<p>Here’s an example of testing a JavaScript module with a JavaScript test. Assume that the module <code class="highlighter-rouge">fibonacci.sjs</code> exposes a
function called <code class="highlighter-rouge">getFibbed</code> that returns a specified number of values from the Fibonacci sequence. The function takes
two parameters: the index of the first number in the sequence to return and the number of values to return. The values 
are to be returned in an array. The index is one-based.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'/test/test-helper.xqy'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fib</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'/lib/fibonacci.sjs'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">assertions</span> <span class="o">=</span> <span class="p">[];</span>

<span class="c1">// Scenario 1: start at the beginning, get back a few numbers</span>

<span class="kd">let</span> <span class="nx">actual</span> <span class="o">=</span> <span class="nx">fib</span><span class="p">.</span><span class="nx">getFibbed</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

<span class="nx">assertions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nx">actual</span><span class="p">.</span><span class="nx">length</span><span class="p">),</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">actual</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">actual</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">actual</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nx">actual</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="p">);</span>

<span class="c1">// Scenario 2: start later in the sequence</span>

<span class="kd">let</span> <span class="nx">actual</span> <span class="o">=</span> <span class="nx">fib</span><span class="p">.</span><span class="nx">getFibbed</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="nx">assertions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nx">actual</span><span class="p">.</span><span class="nx">length</span><span class="p">),</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">actual</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nx">actual</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nx">actual</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="p">);</span>

<span class="nx">assertions</span>
</code></pre></div></div>

<p>Note that the last line returns the <code class="highlighter-rouge">assertions</code> array.</p>

<h2 id="testing-xquery-using-sjs">Testing XQuery using SJS</h2>

<p>MarkLogic Unit Test also allows you to test XQuery library modules with JavaScript. If the <code class="highlighter-rouge">getFibbed</code> function above was
written in XQuery, the code to test it is very similar. In the library module <code class="highlighter-rouge">/lib/fibonacci.xqy</code>, the function was
likely called <code class="highlighter-rouge">get-fibbed</code> and exists in some namespace. JavaScript modules can <code class="highlighter-rouge">require</code> XQuery modules to load them.
The namespace is essentially ignored, and names are converted from “worm case” (<code class="highlighter-rouge">get-fibbed</code>) to camel case 
(<code class="highlighter-rouge">getFibbed</code>). Thus the testing code is nearly identical, except that the required module has a <code class="highlighter-rouge">.xqy</code> extension.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'/test/test-helper.xqy'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fib</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'/lib/fibonacci.xqy'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">assertions</span> <span class="o">=</span> <span class="p">[];</span>

<span class="c1">// Scenario 1: start at the beginning, get back a few numbers</span>

<span class="kd">let</span> <span class="nx">actual</span> <span class="o">=</span> <span class="nx">fib</span><span class="p">.</span><span class="nx">getFibbed</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

<span class="nx">assertions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nx">actual</span><span class="p">.</span><span class="nx">length</span><span class="p">),</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">actual</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">actual</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">actual</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nx">actual</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="p">);</span>

<span class="c1">// Scenario 2: start later in the sequence</span>

<span class="kd">let</span> <span class="nx">actual</span> <span class="o">=</span> <span class="nx">fib</span><span class="p">.</span><span class="nx">getFibbed</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="nx">assertions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nx">actual</span><span class="p">.</span><span class="nx">length</span><span class="p">),</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">actual</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nx">actual</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">assertEqual</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nx">actual</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="p">);</span>

<span class="nx">assertions</span>
</code></pre></div></div>

        </div>
      </div>
    </div>
  </article>


    <footer class="site-footer">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <p>
                    Copyright © 2016-2023 MarkLogic Corporation. All Rights Reserved. MARKLOGIC® is a registered trademark of MarkLogic Corporation.
                    </p>
                </div>
            </div>
        </div>
    </footer>


    <!--[if lt IE 9]>
        <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="/marklogic-unit-test/js/respond.min.js"></script>
    <![endif]-->

    <script type="text/javascript" src="/marklogic-unit-test/assets/bundle.js" id="1"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-79716597-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>

